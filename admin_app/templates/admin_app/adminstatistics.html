{% extends 'admin_app/admin_dashboard.html' %}
{% load humanize %}

{% block content %}
<head>
    <style>
        .box {
            width: 30%;
            padding: 10px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        #charts {
        display: flex;
        flex-wrap: wrap;
        gap: 20px; /* Space between the charts */
        justify-content: space-around; /* Distribute space evenly */
        }

        .chart-container {
            width: 20%; /* Adjust width to fit 3 charts per row */
            min-width: 400px; /* Optional: Set a minimum width for responsiveness */
            height: auto;
        }

        h3{
            margin-bottom: 0;
            color: #ce40b0;
        }

        #forecast-title{
            margin-top: 0;
            color: palevioletred;
        }

        h4{
            color: palevioletred;
        }


        body.dark-mode .box {
            background-color: #717171;
            border-color: #8b8b8b;
            color: #ffffff;
        }

        body.dark-mode h3, body.dark-mode h4 {
            color: #fff; /* Change heading colors */
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script> <!-- Added date adapter -->
</head>
<!-- Total Analytics at the top -->
<div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
    <div class="box">
        <h3>Total Bookings</h3>
        <p>{{ total_bookings }}</p>
    </div>
    <div class="box">
        <h3>Total Passengers</h3>
        <p>{{ total_passengers|floatformat:0 }}</p>
    </div>
    <div class="box">
        <h3>Total Revenue (PHP)</h3>
        <p>â‚±{{ total_revenue|floatformat:0|intcomma }}</p>
    </div>
</div>
<canvas id="destinationPricingChart"></canvas>

<h3 id="forecast-title">Forecast Analytics By Destination</h3>
<div id="charts">
    {% for destination, data in forecasts.items %}
        <div class="chart-container">
            <h4>Destination: {{ destination }}</h4>
            <canvas id="chart-{{ forloop.counter }}"></canvas>
        </div>

        <script>
            const ctx{{ forloop.counter }} = document.getElementById('chart-{{ forloop.counter }}').getContext('2d');
            
            const chartData{{ forloop.counter }} = {
                datasets: [
                    {
                        label: 'Actual PAX',
                        data: [
                            {% for month, pax in data.actual_data.items %}
                                {x: '{{ month }}', y: {{ pax }}},
                            {% endfor %}
                        ],
                        borderColor: 'pink',
                        backgroundColor: 'pink',
                        showLine: true,
                    },
                    {
                        label: 'Forecasted PAX',
                        data: [
                            {% for item in data.combined_data %}
                                {x: '{{ item.date }}', y: {{ item.forecasted_pax }}},
                            {% endfor %}
                        ],
                        borderColor: 'yellow',
                        backgroundColor: 'yellow',
                        showLine: true,
                    }
                ]
            };

            console.log(chartData{{ forloop.counter }}); // Debugging: check the data passed to the chart

            new Chart(ctx{{ forloop.counter }}, {
                type: 'scatter',  // You can change this to 'line' if you prefer a line chart
                data: chartData{{ forloop.counter }},
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Passenger Forecast for {{ destination }}'
                        }
                    },
                    scales: {
                        x: { 
                            title: { display: true, text: 'Date' },
                            type: 'time',  // Ensure this is treated as a time scale
                            time: {
                                unit: 'month',  // Adjust according to your data granularity
                                tooltipFormat: 'll',
                            }
                        },
                        y: { title: { display: true, text: 'PAX' } }
                    }
                }
            });

            
        </script>
    {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('destinationPricingChart').getContext('2d');
    const data = {
        labels: {{ labels|safe }},  // Preprocessed labels (destination names)
        datasets: [{
            label: 'Dynamic Pricing',
            data: {{ data|safe }},  // Preprocessed data (prices)
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    };

    const config = {
        type: 'bar',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Dynamic Pricing by Destination' }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    };

    new Chart(ctx, config);
</script>




{% endblock %}
